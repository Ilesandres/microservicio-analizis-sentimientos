version: '3.8'

services:
  pysentiment:
    build: .
    container_name: pysentiment-api
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
      - PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:128
      - TOKENIZERS_PARALLELISM=false
      - CUDA_VISIBLE_DEVICES=
      - OMP_NUM_THREADS=1
      - MKL_NUM_THREADS=1
      - PYTORCH_NO_CUDA_MEMORY_CACHING=1
      - FORCE_CPU=1
    restart: unless-stopped
    mem_limit: 512m
    mem_reservation: 400m
    deploy:
      resources:
        reservations:
          devices: []

